\documentclass[a4paper, 12pt]{report}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage[ngerman]{babel}
\usepackage{graphicx}
\usepackage{geometry}
\usepackage{csquotes}
\usepackage[toc,page]{appendix}
\usepackage{titlesec}
\usepackage{listings}
\usepackage{float}
\usepackage[hang,flushmargin]{footmisc} 
\usepackage{makecell}
\usepackage{amsmath}% http://ctan.org/pkg/amsmath

\usepackage[default]{cantarell} %% Use option "defaultsans" to use cantarell as sans serif only
\usepackage{hyperref}
\usepackage{helvet}
\usepackage[eulergreek]{sansmath}
\usepackage{amsfonts}
\usepackage{media9}
\usepackage{url}
\usepackage{lscape}
\usepackage{changepage}
\usepackage[usenames,dvipsnames]{color}
\usepackage{matlab-prettifier}
\lstset{style=Matlab-editor}

\usepackage{pifont}% http://ctan.org/pkg/pifont
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%

\usepackage{tikz}
\usetikzlibrary{calc,positioning,shapes,decorations.pathreplacing}
\usetikzlibrary{fit,fadings,shadows,patterns,math}
\usetikzlibrary{shapes.arrows,shapes.geometric}
\usetikzlibrary{arrows,arrows.meta,decorations.markings}
\usetikzlibrary{decorations.pathmorphing}

\graphicspath{ {./images/} }
\geometry{margin=1.25in}

\newcommand*{\shifttext}[2]{%
  \settowidth{\@tempdima}{#2}%
  \makebox[\@tempdima]{\hspace*{#1}#2}%
}
\newcommand{\fakesection}[1]{%
  \par\refstepcounter{section}% Increase section counter
  \sectionmark{#1}% Add section mark (header)
  \addcontentsline{toc}{section}{\protect\numberline{\thesection}#1}% Add section to ToC
  % Add more content here, if needed.
}
\titleformat{\chapter}[display]
  {\normalfont\bfseries}{}{0pt}{\Large}
\titleformat*{\section}{\large\bfseries}

\renewcommand{\footnoterule}{%
  \kern -3pt
  \hrule width \textwidth height 1pt
  \kern 2pt
}

\newcommand\blfootnote[1]{%
  \begingroup
  \renewcommand\thefootnote{}\footnote{#1}%
  \addtocounter{footnote}{-1}%
  \endgroup
}

% This is the color used for MATLAB comments below
\definecolor{MyDarkGreen}{rgb}{0.0,0.4,0.0}

% For faster processing, load Matlab syntax for listings
\lstloadlanguages{Matlab}%
\lstset{language=Matlab,                        % Use MATLAB
        frame=single,                           % Single frame around code
        basicstyle=\small\ttfamily,             % Use small true type font
        keywordstyle=[1]\color{Blue}\bfseries,        % MATLAB functions bold and blue
        keywordstyle=[2]\color{Purple},         % MATLAB function arguments purple
        keywordstyle=[3]\color{Blue}\underbar,  % User functions underlined and blue
        identifierstyle=,                       % Nothing special about identifiers
                                                % Comments small dark green courier
        commentstyle=\usefont{T1}{pcr}{m}{sl}\color{MyDarkGreen}\small,
        stringstyle=\color{Purple},             % Strings are purple
        showstringspaces=false,                 % Don't put marks in string spaces
        tabsize=5,                              % 5 spaces per tab
        %
        %%% Put standard MATLAB functions not included in the default
        %%% language here
        morekeywords={xlim,ylim,var,alpha,factorial,poissrnd,normpdf,normcdf, quadprog, fmincon, fminunc},
        %
        %%% Put MATLAB function parameters here
        morekeywords=[2]{on, off, interp},
        %
        %%% Put user defined functions here
        morekeywords=[3]{confunNeqG},
        %
        morecomment=[l][\color{Blue}]{...},     % Line continuation (...) like blue comment
        inputencoding=latin1
        }
        \lstset{literate=%
        {Ö}{{\"O}}1
        {Ä}{{\"A}}1
        {Ü}{{\"U}}1
        {ß}{{\ss}}1
        {ü}{{\"u}}1
        {ä}{{\"a}}1
        {ö}{{\"o}}1
      }

\begin{document}

\begin{center}
    \vspace*{2em}
    \normalsize 4. Projekt\\
    \vspace*{1em}
    %\normalsize \textbf{\textit{Penalty-Verfahren \& SQP-Verfahren}}\\
    \vspace*{4em}
    \normalsize im Fach\\
    \vspace*{1em}
    \large Numerische Optimierung\\
    \vspace*{30em}
    \normalsize Juli 2020\\
    \vspace*{1em}
    \normalsize Maximilian Gaul
\end{center}

\thispagestyle{empty}

\newpage

\subsubsection{Aufgabe 1}
Siehe \lstinline[basicstyle=\ttfamily\color{black}]|GlobNewton.m|.

\subsubsection{Aufgabe 2}
Siehe auch \lstinline[basicstyle=\ttfamily\color{black}]|Projekt_4.m|.\par

Für die Himmelblau-Funktion

$$ f(x_1, x_2) = (x_1^2 + x_2 - 11)^2 + (x_1 + x_2^2 - 7)^2 $$

gelten folgende Ableitungen

$$ \nabla f(x_1, x_2) = \begin{bmatrix}2(x_1^2 + x_2 - 11)\cdot 2x_1 + 2 (x_1 + x_2^2 - 7)\\2(x_1^2 + x_2 - 11) + 2(x_1 + x_2^2 - 7)\cdot 2x_2\end{bmatrix} $$
$$ H_f(x_1, x_2) = \begin{bmatrix}4(x_1^2 + x_2 - 11) + 8x_1^2 & 4x_1 + 4x_2\\4x_1 + 4x_2 & 4 (x_1 + x_2^2 - 7) + 8x_2^2\end{bmatrix} $$

\begin{figure}[H]
  \centering
  \def\arraystretch{1.25}
  \begin{tabular}{l|c|r}
    \hline
    \textbf{Schritt} & \textbf{x} & \textbf{$f(x)$}\\
    \hline
    1 & $[0.00, 0.00]^T$ & 170.0\\
    2 & $[1.75, 2.75]^T$ & 32.26\\
    3 & $[3.76, 2.22]^T$ & 31.69\\
    4 & $[3.19, 1.96]^T$ & 1.31\\
    5 & $[3.02, 1.99]^T$ & 0.01\\
    $\vdots$ & $\vdots$ & $\vdots$\\
    15 & $[3.00, 2.00]^T$ & $1.10 \cdot 10^{-26}$\\
    \hline
  \end{tabular}
  \caption{Verlauf von \lstinline[basicstyle=\ttfamily\color{black}]|GlobNewton| für $f$ bei einer Genauigkeit von $10^{-12}$}
  \label{convHimmel1}
\end{figure}

\begin{figure}[H]
  \centering
  \def\arraystretch{1.25}
  \begin{tabular}{l|c|r}
    \hline
    \textbf{Schritt} & \textbf{x} & \textbf{$f(x)$}\\
    \hline
    1 & $[-1.20, 1.00]^T$ & 125.11\\
    2 & $[-2.87, 3.87]^T$ & 27.30\\
    3 & $[-2.80, 3.29]^T$ & 1.05\\
    4 & $[-2.80, 3.14]^T$ & 0.00\\
    5 & $[-2.81, 3.13]^T$ & $9.83 \cdot 10^{-7}$\\
    $\vdots$ & $\vdots$ & $\vdots$\\
    12 & $[-2.81, 3.13]^T$ & $4.10 \cdot 10^{-29}$\\
    \hline
  \end{tabular}
  \caption{Verlauf von \lstinline[basicstyle=\ttfamily\color{black}]|GlobNewton| für $f$ bei einer Genauigkeit von $10^{-12}$}
  \label{convHimmel2}
\end{figure}

Für die 2D Rosenbrock-Funktion

$$ g(x_1, x_2) = 100(x_2 - x_1^2)^2 + (1 - x_1)^2 $$

gelten die Ableitungen

$$ \nabla g(x_1, x_2) = \begin{bmatrix} 400x_1^3 - 400x_1x_2 + 2x_1 - 2\\200(x_2 - x_1^2)\end{bmatrix} $$
$$ H_g(x_1, x_2) = \begin{bmatrix} 800x_1^2 - 400(x_2-x_1^2) + 2 & -400x_1\\-400x_1 & 200 \end{bmatrix} $$

\begin{figure}[H]
  \centering
  \def\arraystretch{1.25}
  \begin{tabular}{l|c|r}
    \hline
    \textbf{Schritt} & \textbf{x} & \textbf{$g(x)$}\\
    \hline
    1 & $[0.00, 0.00]^T$ & 1.00\\
    2 & $[0.25, 0.00]^T$ & 0.95\\
    3 & $[0.31, 0.09]^T$ & 0.48\\
    4 & $[0.52, 0.22]^T$ & 0.46\\
    5 & $[0.57, 0.32]^T$ & 0.19\\
    $\vdots$ & $\vdots$ & $\vdots$\\
    15 & $[1.00, 1.00]^T$ & $8.21 \cdot 10^{-28}$\\
    \hline
  \end{tabular}
  \caption{Verlauf von \lstinline[basicstyle=\ttfamily\color{black}]|GlobNewton| für $g$ bei einer Genauigkeit von $10^{-12}$}
\end{figure}

\begin{figure}[H]
  \centering
  \def\arraystretch{1.25}
  \begin{tabular}{l|c|r}
    \hline
    \textbf{Schritt} & \textbf{x} & \textbf{$g(x)$}\\
    \hline
    1 & $[-1.20, 1.00]^T$ & 24.20\\
    2 & $[-1.18, 1.38]^T$ & 4.73\\
    3 & $[-0.93, 0.81]^T$ & 4.09\\
    4 & $[-0.78, 0.59]^T$ & 3.23\\
    5 & $[-0.46, 0.11]^T$ & 3.21\\
    $\vdots$ & $\vdots$ & $\vdots$\\
    12 & $[1.00, 1.00]^T$ & $4.93 \cdot 10^{-28}$\\
    \hline
  \end{tabular}
  \caption{Verlauf von \lstinline[basicstyle=\ttfamily\color{black}]|GlobNewton| für $g$ bei einer Genauigkeit von $10^{-12}$}
\end{figure}

\subsubsection{Aufgabe 3}
Die Hesse-Matrizen der beiden Funktionen $f$ und $g$ ist stetig und kontinuierlich, d.h. es kann in beiden Fällen vom
Zutreffen der Lipschitz-Bedingung

$$ ||H(x) - H(y)|| \leq L||x-y|| \text{  } \forall x,y \in R^n$$

ausgegangen werden. Weiterhin enthalten beide Funktionen keine mehrfachen Nullstellen durch die das Newton-Verfahren
gebremst werden könnte. Aufgrundessen konvergieren beide Funktionen lokal-quadratisch (sollte die Hesse-Matrix eine
Abstiegsrichtung liefern). Global gesehen konvergiert das Newton-Verfahren je nach Schrittweitenstrategie
(ob effizient oder nicht) und Startwert entweder gar nicht aufgrund zu kleiner Schrittweiten (z.B. normales Armijo-Verfahren)
oder zumindest nur superlinearer. Die lokale quadratische Konvergenz der Himmelblau-Funktion kann man in (\ref{convHimmel1})
und (\ref{convHimmel2}) zwischen Schritt 3 und 4 bzw. 2 und 3 gut erkennen. Da beide Funktionen nicht quadratisch sind,
konvergiert das Verfahren nicht in einem einzigen Schritt.\par
Bei Quasi-Newton-Verfahren mit approximierter Hesse-Matrix und effizienter Schrittweitenstrategie kann man global gesehen
von einer superlinearen Konvergenz für beide Funktionen $f$ und $g$ ausgehen. Im gegensatz zum reinen Newton-Verfahren kann man 
die Update-Formeln der Hesse-Matrix so wählen, dass eine Abstiegsrichtung entsteht. Broyden \textit{et al.} haben 1973
in \textit{On the Local and Superlinear Convergence of Quasi-Newton Methods} gezeigt, dass die Fehler in der Approximation
von $H_k$ begrenzt sind und sich nicht unbeschränkt erhöhen und daraus die superlineare Konvergenz
abgeleitet werden kann.\par
Weiterhin sind beide Funktionen nicht quadratischer Natur ansonsten könnte die Schrittweite ggf. exakt berechnet werden.

\subsubsection{Aufgabe 4}

Das Optimierungsproblem

$$ \text{min } -2x_1 - 3x_2 - 4x_3$$

unter den Nebenbedingungen

\begin{align*} 
  x_1 + x_2 + x_3 \leq 4\\
  3x_2 + x_3 \leq 6\\
  x_1 \leq 2\\
  x_3 \leq 3\\
  x_i \geq 0 \text{, } i \in \{1, 2, 3\}
\end{align*}

hat folgende Normalform

$$ \text{min } -2x_1 - 3x_2 - 4x_3$$

\begin{align*} 
  x_1 + x_2 + x_3 + x_4 &= 4 \text{  }(I)\\
  3x_2 + x_3 + x_5 &= 6 \text{  }(II)\\
  x_1 + x_6 &= 2 \text{  }(III)\\
  x_3 + x_7 &= 3 \text{  }(IV)\\
  x_i \geq 0, i \in \{1, 2, 3, 4, 5, &6, 7\} \text{  }(V)
\end{align*}

\subsubsection{Aufgabe 5}

\begin{figure}[H]
  \centering
  \def\arraystretch{1.25}
  \begin{tabular}{l|c c c c c}
    & $\begin{bmatrix} 2\\1\\3\\-3\\0\\0\\0 \end{bmatrix}$ & $\begin{bmatrix} 1\\0\\3\\0\\1\\0\\0 \end{bmatrix}$ & $\begin{bmatrix}1\\0\\3\\0\\3\\1\\0\end{bmatrix}$ & $\begin{bmatrix}2\\2\\0\\0\\0\\0\\3\end{bmatrix}$ & $\begin{bmatrix}2\\1\\1\\0\\2\\0\\2\end{bmatrix}$\\
    \hline
    $(I)$ & \xmark & \cmark & \cmark & \cmark & \cmark \\
    $(II)$ & \cmark & \xmark & \cmark & \cmark & \cmark \\
    $(III)$ & \cmark & \xmark & \cmark & \cmark & \cmark \\
    $(IV)$ & \cmark & \cmark & \cmark & \cmark & \cmark \\
    $(V)$ & \xmark & \cmark & \cmark & \cmark & \cmark \\
  \end{tabular}
\end{figure}

Die Vektoren $x^{(3)}$, $x^{(4)}$ und $x^{(5)}$ sind gültige Basisvektoren während $x^{(1)}$ einen negativen Eintrag enthält
sowie nicht alle Nebenbedingungen erfüllt. $x^{(2)}$ erfüllt ebenfalls nicht alle Nebenbedingungen.

\subsubsection{Aufgabe 6}

Das Optimierungsproblem lässt sich in Matrixschreibweise als lineares Gleichungssystem der Form $Ax = b$ schreiben

$$ \begin{bmatrix}1 & 1 & 1 & 1 & 0 & 0 & 0\\0 & 3 & 1 & 0 & 1 & 0 & 0\\1 & 0 & 0 & 0 & 0 & 1 & 0\\0 & 0 & 1 & 0 & 0 & 0 & 1\end{bmatrix} \cdot x = \begin{bmatrix}4\\6\\2\\3\end{bmatrix} $$

Aus dem angegebenen Basisvektor $x = \begin{bmatrix}2\\0\\2\\0\\4\\0\\1\end{bmatrix}$ kann man die Indexmengen
$B = \{1, 3, 5, 7\}$ und $N = \{2, 4, 6\}$ ablesen. $B$ enthält die Indizes bei denen $x_i \neq 0$ sind
während $N$ gerade die Einträge enthält, bei denen $x_i = 0$ sind. Daraus wiederum kann man $A_B$ und $A_N$ bilden

$$ A_B = \begin{bmatrix} 1 & 1 & 0 & 0\\0 & 1 & 1 & 0\\1 & 0 & 0 & 0\\0 & 1 & 0 & 1 \end{bmatrix} A_N = \begin{bmatrix} 1 & 1 & 0\\3 & 0 & 0\\0 & 0 & 1\\0 & 0 & 0 \end{bmatrix} $$

die gerade die Spalten aus $A$ enthalten, die in der jeweiligen Indexmenge angegeben sind.

Mit

$$ A_B^{-1} = \begin{bmatrix} 0 & 0 & 1 & 0\\1 & 0 & -1 & 0\\-1 & 1 & 1 & 0\\-1 & 0 & 1 & 1 \end{bmatrix} $$

kann man nun $\Gamma$ berechnen

$$ \Gamma = A_B^{-1}\cdot A_N = \begin{bmatrix} 0 & 0 & 1\\1 & 1 & -1\\2 & -1 & 1\\-1 & -1 & 1 \end{bmatrix} $$

und $\beta_B = A_B^{-1}\cdot b = \begin{bmatrix} 2\\2\\4\\1 \end{bmatrix}$. Mit zusätzlichem
$c = \begin{bmatrix} -2\\-3\\-4\\0\\0\\0\\0 \end{bmatrix}$ und $c_B = \begin{bmatrix} -2\\-4\\0\\0 \end{bmatrix}$,
$c_N = \begin{bmatrix} -3\\0\\0 \end{bmatrix}$ lässt sich $\xi = \Gamma^Tc_B - c_N = \begin{bmatrix} -1\\-4\\2 \end{bmatrix}$
berechnen und das Tableau aufstellen (Pivot-Element farbig hinterlegt):

\begin{figure}[H]
  \centering
  \def\arraystretch{1.25}
  \begin{tabular}{l|c c c|c|c}
    & $x_2$ & $x_4$ & $x_6$ & &\\
    \hline
    $x_1$ & 0 & 0 & 1 & 2 & 2\\
    $x_3$ & 1 & 1 & -1 & 2 & /\\
    $x_5$ & 2 & -1 & 1 & 4 & 4\\
    $x_7$ & -1 & -1 & \colorbox{blue!30}{1} & 1 & 1\\
    \hline
    & -1 & -4 & 2 & -12 &
  \end{tabular}
\end{figure}

$q = 6, p = 7$, es werden also die Elemente $x_7$ und $x_6$ getauscht. Daraus entstehen die neuen Index-Mengen
$B = \{1, 3, 5, 6\}$ und $N=\{2, 4, 7\}$

Daraus lässt sich wieder bestimmen

$$ A_B = \begin{bmatrix} 1 & 1 & 0 & 0\\0 & 1 & 1 & 0\\1 & 0 & 0 & 1\\0 & 1 & 0 & 0 \end{bmatrix} A_N = \begin{bmatrix} 1 & 1 & 0\\3 & 0 & 0\\0 & 0 & 0\\0 & 0 & 1 \end{bmatrix} A_B^{-1} = \begin{bmatrix} 1 & 0 & 0 & -1\\0 & 0 & 0 & 1\\0 & 1 & 0 & -1\\-1 & 0 & 1 & 1 \end{bmatrix} $$

und draus wiederum

$$ \Gamma = A_B^{-1}A_N = \begin{bmatrix} 1 & 1 & -1\\0 & 0 & 1\\3 & 0 & -1\\-1 & -1 & 1 \end{bmatrix} \beta_B = A_B^{-1}b = \begin{bmatrix} 1\\3\\3\\1 \end{bmatrix} $$

Mit $c_B = \begin{bmatrix} -2\\-4\\0\\0 \end{bmatrix}, c_N = \begin{bmatrix} -3\\0\\0 \end{bmatrix} $ kann man bestimmen
$\xi = \Gamma^Tc_B - c_N = \begin{bmatrix} 1\\-2\\-2 \end{bmatrix}$ und daraus das neue Tableau aufstellen

\begin{figure}[H]
  \centering
  \def\arraystretch{1.25}
  \begin{tabular}{l|c c c|c|c}
    & $x_2$ & $x_4$ & $x_7$ & &\\
    \hline
    $x_1$ & 1 & 1 & -1 & 1 & \\
    $x_3$ & 0 & 0 & 1 & 3 & \\
    $x_5$ & 3 & 0 & -1 & 3 & \\
    $x_6$ & -1 & -1 & 1 & 1 & \\
    \hline
    & 1 & -2 & -2 & -14 &
  \end{tabular}
\end{figure}

Selbiges erhält man durch die Update-Formel:

\begin{figure}[H]
  \centering
  \def\arraystretch{1.25}
  \begin{tabular}{l|c c c|c|c}
    & $x_2$ & $x_4$ & $x_7$ & &\\
    \hline
    $x_1$ & $0 - \frac{1\cdot(-1)}{1}$ & $0 - \frac{1\cdot(-1)}{1}$ & $\frac{-1}{1}$ & $2 - \frac{1\cdot 1}{1}$ & \\
    $x_3$ & $1-\frac{-1\cdot(-1)}{1}$ & $1 - \frac{-1\cdot(-1)}{1}$ & $-1\frac{-1}{1}$ & $2-\frac{-1\cdot 1}{1}$ & \\
    $x_5$ & $2 - \frac{1\cdot (-1)}{1}$ & $-1 - \frac{1\cdot(-1)}{1}$ & $\frac{-1}{1}$ & $4 - \frac{1\cdot 1}{1}$ & \\
    $x_6$ & $\frac{-1}{1}$ & $\frac{-1}{1}$ & $\frac{1}{1}$ & $\frac{1}{1}$ & \\
    \hline
    & $-1-\frac{2\cdot(-1)}{1}$ & $-4-\frac{2\cdot(-1)}{1}$ & -$\frac{2}{1}$ & $-12-\frac{2}{1}$ &
  \end{tabular}
\end{figure}

Aktuell ist $x = \begin{bmatrix} 1\\0\\3\\0\\3\\1\\0 \end{bmatrix}$ mit $f(x) = -14$.

\end{document}