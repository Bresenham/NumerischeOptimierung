\documentclass[a4paper, 12pt]{report}
\usepackage{graphicx}
\usepackage[utf8]{inputenc}
\usepackage[ngerman]{babel}
\usepackage{geometry}
\usepackage{csquotes}
\usepackage[toc,page]{appendix}
\usepackage{titlesec}
\usepackage{listings}
\usepackage{float}
\usepackage[hang,flushmargin]{footmisc} 
\usepackage{makecell}
\usepackage{amsmath}% http://ctan.org/pkg/amsmath
\usepackage[utf8]{inputenc}
\usepackage[default]{cantarell} %% Use option "defaultsans" to use cantarell as sans serif only
\usepackage[T1]{fontenc}
\usepackage{hyperref}
\usepackage{helvet}
\usepackage[eulergreek]{sansmath}
\usepackage{amsfonts}
\usepackage{movie15}
\usepackage{url}
\usepackage{lscape}
\usepackage{changepage}

\usepackage{tikz}
\usetikzlibrary{calc,positioning,shapes,decorations.pathreplacing}
\usetikzlibrary{fit,fadings,shadows,patterns,math}
\usetikzlibrary{shapes.arrows,shapes.geometric}
\usetikzlibrary{arrows,arrows.meta,decorations.markings}
\usetikzlibrary{decorations.pathmorphing}

\graphicspath{ {./images/} }
\geometry{margin=1.25in}

\newcommand*{\shifttext}[2]{%
  \settowidth{\@tempdima}{#2}%
  \makebox[\@tempdima]{\hspace*{#1}#2}%
}
\newcommand{\fakesection}[1]{%
  \par\refstepcounter{section}% Increase section counter
  \sectionmark{#1}% Add section mark (header)
  \addcontentsline{toc}{section}{\protect\numberline{\thesection}#1}% Add section to ToC
  % Add more content here, if needed.
}
\titleformat{\chapter}[display]
  {\normalfont\bfseries}{}{0pt}{\Large}
\titleformat*{\section}{\large\bfseries}

\renewcommand{\footnoterule}{%
  \kern -3pt
  \hrule width \textwidth height 1pt
  \kern 2pt
}

\newcommand\blfootnote[1]{%
  \begingroup
  \renewcommand\thefootnote{}\footnote{#1}%
  \addtocounter{footnote}{-1}%
  \endgroup
}

\begin{document}

\begin{center}
    \vspace*{2em}
    \normalsize 3. Projekt\\
    \vspace*{1em}
    \normalsize \textbf{\textit{Penalty-Verfahren \& SQP-Verfahren}}\\
    \vspace*{4em}
    \normalsize im Fach\\
    \vspace*{1em}
    \large Numerische Optimierung\\
    \vspace*{30em}
    \normalsize Juni 2020\\
    \vspace*{1em}
    \normalsize Maximilian Gaul
\end{center}

\thispagestyle{empty}

\newpage

\subsubsection{Aufgabe 1}

\subsubsection{Aufgabe 2}
Implementierung siehe \lstinline[basicstyle=\ttfamily\color{black}]|BFGS_Pen.m| und
\lstinline[basicstyle=\ttfamily\color{black}]|ArmijoPen.m|.

\subsubsection{Aufgabe 3}
Tests siehe \lstinline[basicstyle=\ttfamily\color{black}]|Projekt_3.m|.

\subsubsection{Aufgabe 4}

Das Problem

$$f(x) = \text{min } x_1$$

unter den Nebenbedingungen

$$g_1(x) = x_1^2 + x_2^2 - 1 \leq 0$$
$$g_2(x) = x_1 + x_2 - \gamma \leq 0 \text{, } \gamma \geq -\sqrt{2}$$

lässt sich so graphisch darstellen:

\begin{figure}[H]
  \centering
  \begin{tikzpicture}
    \newcommand*{\from}{-3}
    \newcommand*{\too}{3}
    \newcommand*{\drawFrom}{-1}
    \newcommand*{\drawTo}{1}
    \newcommand*{\scaleFactor}{1}

    \tikzstyle{interval border}=[thin, red];
    \draw[-{Latex}] (\from*\scaleFactor,0) -- (\too*\scaleFactor,0) node[right] {$x_1$};
    \draw[-{Latex}] (0,\from*\scaleFactor) -- (0,\too*\scaleFactor) node[above] {$x_2$};

    \draw (0, 0) node[xshift=-0.21cm, yshift=-0.25cm, font=\small] {$0$};

    \foreach \x in {-3, -2, -1, 1, 2, 3} {
      \draw (\x*\scaleFactor, 0) node[yshift=-0.25cm, font=\small] {$\x$};
      \draw (0,\x*\scaleFactor) node[xshift=-0.425cm, font=\small] {$\x$};
    }

    \draw[red, fill=orange, opacity=0.5, thick] (0,0) circle (1 cm);

    \draw[blue, thick] (1.6, -3.014) -- (-1.6, 0.18579);
    \draw[blue, thick] (-1.6, 3.014) -- (1.6, -0.18579);

    \node[xshift=-2cm, yshift=0.5cm, font=\tiny, draw, thin, rectangle] (ppre) at (-1.6, 0.18579) {$x_1 + x_2 \leq -\sqrt{2}$};
    \draw[-{Latex}] (ppre.east) -- +(+5pt,0pt) -- (-1.6, 0.18579);

    \node[xshift=-2cm, yshift=0.5cm, font=\tiny, draw, thin, rectangle] (ppre) at (-1.6, 3.014) {$x_1 + x_2 \leq \sqrt{2}$};
    \draw[-{Latex}] (ppre.east) -- +(+5pt,0pt) -- (-1.6, 3.014);

    \node[xshift=2cm, yshift=1.5cm, font=\tiny, draw, thin, rectangle] (ppre) at (0.9, 0.4359) {$x_1^2 + x_2^2 \leq 1$};
    \draw[-{Latex}] (ppre.west) -- +(-5pt,0pt) -- (0.9, 0.4359);

    \draw[black, fill=black, thick] (0,0) circle (0.025cm);
    \draw[-{Latex}] (0, 0) -- node[font=\tiny, above=-0.1cm] {$\nabla f$} (1,0);

    \fill[opacity=0.125, blue] (1.6, -3.014) -- (-1.6, 0.18579) -- (-1.6, 3.014) -- (1.6, -0.18579) -- cycle;

  \end{tikzpicture}
  \caption{Graphische Darstellung der Zielfunktion und Nebenbedingungen, gültige Punkte müssen in der Schnittmenge aus Blau und Orange liegen}
\end{figure}

Anhand der Lagrange-Funktion:

$$L(x, \lambda) = x_1 + \lambda_1(x_1^2 + x_2^2 - 1) + \lambda_2(x_1 + x_2 - \gamma)$$

und den Ableitungen:

$$\nabla f(x) = \begin{bmatrix}1 \\ 0\end{bmatrix} \text{, } \nabla g_1(x) = \begin{bmatrix}2x_1\\2x_2\end{bmatrix} \text{, } \nabla g_2(x) = \begin{bmatrix}1\\1\end{bmatrix}$$

kann man die KKT-Bedingungen aufstellen:

$$\nabla_x L(x, \lambda) = \nabla f(x) + \lambda_1\nabla g_1(x) + \lambda_2\nabla g_2(x) = 0 \text{ (Stationarität)}$$

$$ \Leftrightarrow \begin{bmatrix}1\\0\end{bmatrix} + \lambda_1\cdot \begin{bmatrix}2x_1\\2x_2\end{bmatrix} + \lambda_2\cdot \begin{bmatrix}1\\1\end{bmatrix} = \begin{bmatrix}0\\0\end{bmatrix}$$

$$\lambda_1\text{, } \lambda_2 \geq 0\text{, } \lambda_1\cdot (x_1^2 + x_2^2 - 1) = 0 \text{, } \lambda_2\cdot (x_1 + x_2 - \gamma) = 0 \text{ (Komplementarität)}$$
$$g_1(x) \leq 0 \text{, } g_2(x) \leq 0 \text{ (Zulässigkeit)}$$

Um die Komplementarität zu erfüllen kann man nun verschiedene Faktoren gleich Null setzen.\par

Für $\lambda_1 = 0$ und $\lambda_2 = 0$ erhält man einen Widerspruch in der Stationarität, ebenso für
$\lambda_1 = 0$ und $\lambda_2 \neq 0$.\par
Für $\lambda_1 \neq 0$ und $\lambda_2 = 0$ erhält man:

$$\begin{bmatrix}1\\0\end{bmatrix} + \lambda_1 \cdot \begin{bmatrix}2x_1\\2x_2\end{bmatrix} = \begin{bmatrix}0\\0\end{bmatrix}$$

mit

$$1 + 2\lambda_1x_1 = 0$$
$$2\lambda_1x_2 = 0 \Rightarrow^{\lambda_1 \neq 0} x_2 = 0$$

Da $\lambda_1 \neq 0$ muss wegen der Komplementarität zwangsläufig gelten\\
$x_1^2 + x_2^2 = 1 \Leftrightarrow x_1 = \pm \sqrt{1 - x_2^2}$ bzw. $x_1 = \pm 1$. Nun einsetzen

$$1 + 2\lambda_1 = 0 \Leftrightarrow \lambda_1 = -\frac{1}{2} \text{  (ungültig) }$$
$$1 - 2\lambda_1 = 0 \Leftrightarrow \lambda_1 = \frac{1}{2}$$

Damit erhält man den KKT-Punkt: $x_1 = -1 \text{ , } x_2 = 0$.\par

Für $\lambda_1 \neq 0$ und $\lambda_2 \neq 0$ erhält man

$$x_1 + x_2 - \gamma = 0 \Leftrightarrow x_1 = \gamma - x_2$$

$$x_1^2 + x_2^2 - 1 = 0 \Leftrightarrow (\gamma - x_2)^2 + x_2^2 - 1 = 0 \Leftrightarrow x_2 = \pm \sqrt{\frac{2(1-\gamma^2) + \gamma^2}{4}} + \frac{1}{2}\gamma$$

$$\Leftrightarrow x_2 = \pm \frac{1}{2}\cdot \sqrt{\gamma^2 + 2(1-\gamma^2)} + \frac{1}{2}\gamma \Rightarrow x_1 = \gamma - \left(\pm \frac{1}{2}\cdot \sqrt{\gamma^2 + 2(1-\gamma^2)} + \frac{1}{2}\gamma \right)$$

Für $x_1 = \gamma - \frac{1}{2}\sqrt{\gamma^2 + 2(1 - \gamma^2)} - \frac{1}{2}\gamma \Leftrightarrow x_1 = \frac{1}{2}\gamma - \frac{1}{2}\sqrt{\gamma^2 + 2(1 - \gamma^2)}$ und\\
$x_2 = \frac{1}{2}\sqrt{\gamma^2 - 2(1 - \gamma^2)} + \frac{1}{2}\gamma$ erhält man die Stationaritätsgleichung

$$\begin{bmatrix}1\\0\end{bmatrix} + \lambda_1 \cdot \begin{bmatrix}2\cdot\left(\frac{1}{2}\gamma - \frac{1}{2}\sqrt{\gamma^2 + 2(1 - \gamma^2)}\right)\\2\cdot\left(\frac{1}{2}\sqrt{\gamma^2 + 2(1 - \gamma^2)} + \frac{1}{2}\gamma\right)\end{bmatrix} + \lambda_2\cdot\begin{bmatrix}1\\1\end{bmatrix} = \begin{bmatrix}0\\0\end{bmatrix}$$

Mit

$$\lambda_1 \cdot \left(\sqrt{\gamma^2 + 2(1 - \gamma^2)} + \gamma\right) + \lambda_2 = 0 \Leftrightarrow \lambda_2 = -\lambda_1 \cdot \left(\sqrt{\gamma^2 + 2(1 - \gamma^2)} + \gamma\right)$$

kann man einsetzen in die 1. Gleichung:

$$1 + \lambda_1\cdot \left(\gamma - \sqrt{\gamma^2 + 2(1 - \gamma^2)}\right) - \lambda_1\cdot \left(\sqrt{\gamma^2 + 2(1 - \gamma^2)} + \gamma\right) = 0$$

und erhält

$$\lambda_1 = \frac{1}{2\sqrt{\gamma^2 + 2(1 - \gamma^2)}} \text{ , } \lambda_2 = - \frac{\sqrt{\gamma^2 + 2(1 - \gamma^2)} + \gamma}{2\sqrt{\gamma^2 + 2(1 - \gamma^2)}}$$

Für $\gamma \neq \pm \sqrt{2}$ ist $\lambda_1$ immer positiv. Für $-\sqrt{2} < \gamma \leq -1$ ist $\lambda_2$ ebenfalls positiv.
D.h. $x_1 = \frac{1}{2}\gamma - \frac{1}{2}\sqrt{\gamma^2 + 2(1 - \gamma^2)}$ und $x_2 = \frac{1}{2}\sqrt{\gamma^2 - 2(1 - \gamma^2)} + \frac{1}{2}\gamma$ ist ein KKT-Punkt.

Weiterhin erhält man für $x_1 = \gamma - \left(-\frac{1}{2}\sqrt{\gamma^2 + 2(1 - \gamma^2)} + \frac{1}{2}\gamma\right)$\\
$\Leftrightarrow x_1 = \frac{1}{2}\gamma + \frac{1}{2}\sqrt{\gamma^2 + 2(1 - \gamma^2)}$ und $x_2 = - \frac{1}{2}\sqrt{\gamma^2 + 2(1 - \gamma^2)} + \frac{1}{2}\gamma$

$$\begin{bmatrix}1\\0\end{bmatrix} + \lambda_1 \cdot \begin{bmatrix}2\cdot \left(\frac{1}{2}\gamma + \frac{1}{2}\sqrt{\gamma^2 + 2(1 - \gamma^2)}\right)\\2\cdot \left(-\frac{1}{2}\sqrt{\gamma^2 + 2(1-\gamma^2)} + \frac{1}{2}\gamma\right)\end{bmatrix} + \lambda_2 \cdot \begin{bmatrix}1\\1\end{bmatrix} =\begin{bmatrix}0\\0\end{bmatrix}$$

Und

$$\lambda_1 = - \frac{1}{2\sqrt{\gamma^2 + 2(1 - \gamma^2)}} \text{ , } \lambda_2 = \frac{-\sqrt{\gamma^2 + 2(1 - \gamma^2)} + \gamma}{2\sqrt{\gamma^2 + 2(1 - \gamma^2)}}$$

Da $\lambda_1$ für $\gamma \neq \pm \sqrt{2}$ immer negativ ist, ist dies kein KKT-Punkt.

\subsubsection{Aufgabe 5}

\begin{figure}[H]
  \centering
  \begin{tikzpicture}
    \newcommand*{\from}{-3}
    \newcommand*{\too}{3}
    \newcommand*{\drawFrom}{-1}
    \newcommand*{\drawTo}{1}
    \newcommand*{\scaleFactor}{1}

    \tikzstyle{interval border}=[thin, red];
    \draw[-{Latex}] (\from*\scaleFactor,0) -- (\too*\scaleFactor,0) node[right] {$x_1$};
    \draw[-{Latex}] (0,\from*\scaleFactor) -- (0,\too*\scaleFactor) node[above] {$x_2$};

    \draw (0, 0) node[xshift=-0.21cm, yshift=-0.25cm, font=\small] {$0$};

    \foreach \x in {-3, -2, -1, 1, 2, 3} {
      \draw (\x*\scaleFactor, 0) node[yshift=-0.25cm, font=\small] {$\x$};
      \draw (0,\x*\scaleFactor) node[xshift=-0.425cm, font=\small] {$\x$};
    }

    \draw[red, thick] (0,0) circle (1 cm);

    \draw[blue, thick] (1.6, -3.014) -- (-1.6, 0.18579);
    \draw[blue, thick] (-1.6, 3.014) -- (1.6, -0.18579);
    \draw[blue, thick] (-1.6, 1.6) -- (1.6, -1.6);

    \node[xshift=-2cm, yshift=0.5cm, font=\tiny, draw, thin, rectangle] (ppre) at (-1.6, 0.18579) {$x_1 + x_2 = -\sqrt{2}$};
    \draw[-{Latex}] (ppre.east) -- +(+5pt,0pt) -- (-1.6, 0.18579);

    \node[xshift=-2cm, yshift=0.5cm, font=\tiny, draw, thin, rectangle] (ppre) at (-1.6, 1.6) {$x_1 + x_2 = 0$};
    \draw[-{Latex}] (ppre.east) -- +(+5pt,0pt) -- (-1.6, 1.6);

    \node[xshift=-2cm, yshift=0.5cm, font=\tiny, draw, thin, rectangle] (ppre) at (-1.6, 3.014) {$x_1 + x_2 = \sqrt{2}$};
    \draw[-{Latex}] (ppre.east) -- +(+5pt,0pt) -- (-1.6, 3.014);

    \node[xshift=2cm, yshift=1.5cm, font=\tiny, draw, thin, rectangle] (ppre) at (0.9, 0.4359) {$x_1^2 + x_2^2 = 1$};
    \draw[-{Latex}] (ppre.west) -- +(-5pt,0pt) -- (0.9, 0.4359);

    \draw[black, fill=black, thick] (0,0) circle (0.025cm);
    \draw[-{Latex}] (0, 0) -- node[font=\tiny, above=-0.1cm] {$\nabla f$} (1,0);

  \end{tikzpicture}
  \caption{Graphische Darstellung der Zielfunktion und Nebenbedingungen, gültige Punkte liegen auf der Schnittmenge zwischen Kreis und blauen Linien}
\end{figure}

Anhand der Lagrange-Funktion:

$$L(x,\mu) = x_1 + \mu_1\left( x_1^2 + x_2^2 - 1 \right) + \mu_2\left( x_1 + x_2 - \gamma \right)$$

und den Ableitungen

$$\nabla f(x) = \begin{bmatrix}1 \\ 0\end{bmatrix} \text{, } \nabla h_1(x) = \begin{bmatrix}2x_1\\2x_2\end{bmatrix} \text{, } h_2(x) = \begin{bmatrix}1\\1\end{bmatrix}$$

kann man die KKT-Bedingungen aufstellen:

$$\begin{bmatrix}1 \\ 0\end{bmatrix} + \mu_1 \cdot \begin{bmatrix}2x_1\\2x_2\end{bmatrix} + \mu_2 \cdot \begin{bmatrix}1\\1\end{bmatrix} = \begin{bmatrix}0\\0\end{bmatrix} \text{ (Stationarität)}$$

sowie

$$h_1(x) = 0 \text{, } h_2(x) = 0 \text{ (Zulässigkeit)}$$

Mit

$$x_1 = \frac{-\mu_2 - 1}{2\mu_1} \text{ und } x_2 = \frac{-\mu_2}{2\mu_1}$$

kann man in die 2. Nebenbedingung einsetzen

$$ \frac{-\mu_2 - 1}{2\mu_1} + \frac{-\mu_2}{2\mu_1} = \gamma$$

und erhält

$$\mu_2 = -\gamma\mu_1 - \frac{1}{2}$$

Was man wiederum in die 1. Nebenbedingung einsetzen kann

$$ \left( \frac{-\left(-\gamma\mu_1 - \frac{1}{2}\right) - 1}{2\mu_1} \right)^2 + \left( \frac{-\left(-\gamma\mu_1 - \frac{1}{2}\right)}{2\mu_1} \right)^2 = 1$$

Dann erhält man

$$\mu_1 = \pm \frac{1}{2\cdot \sqrt{2 - \gamma^2}} \text{, } \mu_2 = \mp \frac{\gamma}{2\cdot \sqrt{2 - \gamma^2}} - \frac{1}{2}$$

Insgesamt erhält man also die KKT-Punkte:

$$x_1 = \sqrt{2 - \gamma^2} \cdot \left( \frac{\gamma}{2\cdot\sqrt{2 - \gamma^2}} - \frac{1}{2} \right) \text{ , } x_2 = \sqrt{2 - \gamma^2} \cdot \left( \frac{\gamma}{2\cdot\sqrt{2 - \gamma^2}} + \frac{1}{2} \right)$$

und

$$x_1 = -\sqrt{2 - \gamma^2}\cdot \left(-\frac{\gamma}{2\cdot \sqrt{2 - \gamma^2}} - \frac{1}{2}\right) \text{ , } x_2 = -\sqrt{2 - \gamma^2} \cdot \left( \frac{1}{2} - \frac{\gamma}{2\cdot\sqrt{2 - \gamma^2}} \right)$$

\subsubsection{Aufgabe 6}

Implementierung siehe \lstinline[basicstyle=\ttfamily\color{black}]|Projekt_3.m|.

\end{document}